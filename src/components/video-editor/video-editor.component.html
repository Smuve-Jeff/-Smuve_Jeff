<div class="w-full text-neutral-200 p-4 bg-violet-900/50 border border-violet-500/30 flex flex-col gap-4 relative min-h-[600px]">
  <h2 class="text-center text-lg text-violet-400">[ AURA VIDEO LAB ]</h2>

  @if (error()) {
    <div class="bg-red-900/50 text-red-300 p-3 text-center border border-red-500 animate-fade-in">
      {{ error() }}
    </div>
  }

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-grow">
    <!-- Camera & Recording -->
    <div class="flex flex-col gap-4 border border-violet-500/20 p-4">
      <h3 class="text-base text-violet-300">// CAMERA & RECORDING</h3>
      <div class="flex-grow flex items-center justify-center border-2 border-dashed border-violet-700/50 p-2 min-h-[200px] overflow-hidden bg-black relative">
        <video #liveVideoPreview class="max-w-full max-h-full object-contain" autoplay muted playsinline></video>
        @if (!isCameraActive()) {
          <span class="absolute text-neutral-500 text-sm">[ Camera Off ]</span>
        }
        @if (isRecording()) {
          <span class="absolute top-2 left-2 text-red-500 animate-pulse text-sm flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-red-500"></span> REC: {{ formatTime(recordingTime()) }}
          </span>
        }
      </div>
      
      <div class="flex gap-2">
        <button (click)="toggleCamera()"
          class="flex-grow px-4 py-2 border-2 border-violet-500 bg-violet-800 text-violet-300 hover:bg-violet-500 hover:text-black text-lg"
          [disabled]="isRecording()">
          @if (isCameraActive()) {
            <span>[ DISABLE CAMERA ]</span>
          } @else {
            <span>[ ENABLE CAMERA ]</span>
          }
        </button>
      </div>
      <div class="flex gap-2">
         <button (click)="startRecording()" 
            class="flex-grow px-4 py-2 border-2 border-green-500 bg-green-800 text-green-300 hover:bg-green-500 hover:text-black text-lg"
            [disabled]="isRecording() || !isCameraActive()">
            @if (isRecording()) {
              <span>[ RECORDING... ]</span>
            } @else {
              <span>[ START RECORDING ]</span>
            }
          </button>
          <button (click)="stopRecording()" 
            class="px-4 py-2 border-2 border-red-500 bg-red-800 text-red-300 hover:bg-red-500 hover:text-black text-lg"
            [disabled]="!isRecording()">
            [ STOP ]
          </button>
      </div>

      <!-- Recorded Video Preview -->
      @if (recordedVideoUrl()) {
        <h3 class="text-base text-violet-300 mt-4">// RECORDED VIDEO</h3>
        <div class="flex items-center justify-center border-2 border-dashed border-violet-700/50 p-2 min-h-[200px] overflow-hidden bg-black">
          <video #recordedVideoPlayer [src]="recordedVideoUrl()" controls class="max-w-full max-h-full object-contain"></video>
        </div>
        <a [href]="recordedVideoUrl()!" download="aura-recorded-video.webm"
           class="w-full text-center px-4 py-2 border-2 border-violet-500 bg-violet-800 text-violet-300 hover:bg-violet-500 hover:text-black text-lg">
           [ DOWNLOAD RECORDED VIDEO ]
        </a>
      }
    </div>

    <!-- AI Video Generation -->
    <div class="flex flex-col gap-4 border border-violet-500/20 p-4">
      <h3 class="text-base text-violet-300">// AI VIDEO GENERATION</h3>
      @if (imageForVideoGeneration()) {
        <div class="flex flex-col items-center gap-2">
          <h4 class="text-sm text-neutral-400">// IMAGE INPUT FROM EDITOR</h4>
          <img [src]="imageForVideoGeneration()!" alt="Image from editor" class="w-24 h-24 object-cover border border-neutral-600">
        </div>
      }
      <label for="video-prompt" class="block text-sm text-violet-300">VIDEO PROMPT:</label>
      <textarea id="video-prompt" 
        [value]="videoPrompt()" 
        (input)="videoPrompt.set($event.target.value)"
        placeholder="e.g., 'A neon hologram of a cat driving at top speed', 'A futuristic city at sunset with flying cars and towering skyscrapers.'" 
        rows="4" 
        class="w-full bg-violet-800/50 border border-violet-500/50 text-neutral-200 p-2 text-sm focus:ring-violet-500 focus:border-violet-500 resize-y"
        [disabled]="isGeneratingVideo() || !isAiAvailable()"></textarea>
      
      <div class="flex flex-col gap-2">
        <button (click)="generateVideo(false)" 
          class="flex-grow px-4 py-2 border-2 border-violet-500 bg-violet-800 text-violet-300 hover:bg-violet-500 hover:text-black text-lg"
          [disabled]="!videoPrompt() || isGeneratingVideo() || !isAiAvailable()">
          @if (isGeneratingVideo()) {
            <span>[ GENERATING... ]</span>
          } @else {
            <span>[ GENERATE FROM PROMPT ]</span>
          }
        </button>
        @if (imageForVideoGeneration()) {
          <button (click)="generateVideo(true)" 
            class="flex-grow px-4 py-2 border-2 border-violet-500 bg-violet-800 text-violet-300 hover:bg-violet-500 hover:text-black text-lg"
            [disabled]="!videoPrompt() || isGeneratingVideo() || !isAiAvailable()">
            @if (isGeneratingVideo()) {
              <span>[ GENERATING... ]</span>
            } @else {
              <span>[ GENERATE FROM IMAGE + PROMPT ]</span>
            }
          </button>
        }
      </div>

      @if (generationProgressMessage()) {
        <p class="text-sm text-neutral-400 mt-2 text-center animate-pulse">{{ generationProgressMessage() }}</p>
      }

      <!-- Generated Video Display -->
      @if (generatedVideoUrl()) {
        <h3 class="text-base text-violet-300 mt-4">// GENERATED AI VIDEO</h3>
        <div class="flex items-center justify-center border-2 border-dashed border-violet-700/50 p-2 min-h-[200px] overflow-hidden bg-black">
          <video [src]="generatedVideoUrl()!" controls autoplay loop muted playsinline class="max-w-full max-h-full object-contain"></video>
        </div>
        <a [href]="generatedVideoUrl()!" download="aura-ai-generated-video.mp4"
           class="w-full text-center px-4 py-2 border-2 border-violet-500 bg-violet-800 text-violet-300 hover:bg-violet-500 hover:text-black text-lg">
           [ DOWNLOAD AI VIDEO ]
        </a>
      }
    </div>
  </div>

  <div class="flex justify-center mt-4">
    <button (click)="clearAll()" 
      class="px-6 py-2 border-2 border-neutral-500 bg-neutral-800 text-neutral-300 hover:bg-neutral-500 hover:text-black text-lg">
      [ CLEAR ALL ]
    </button>
  </div>
</div>
